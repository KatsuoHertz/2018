# -*- coding: UTF-8 -*-

import numpy as np

# 正解 R, T
R = np.array([
    [-2.03774,   -0.0297132, -0.01369],
    [ 0.0234687, -1.92181,    0.677886],
    [ -0.0227928,  0.677641,   1.92191]
    ])
T = np.array([25.054,-592.987,741.407])

#print(R)
#print(T)

# 一つ目のセンサーから得られた平面の方程式
a1 = [1, 2, 3, 4]
a2 = [3, -2, -1, 5]
a3 = [-2, -1, 4, 2]

# 2つ目のセンサーで得られる平面の方程式
a11 = a1[0]
a12 = a1[1]
a13 = a1[2]
a14 = a1[3]
a21 = a2[0]
a22 = a2[1]
a23 = a2[2]
a24 = a2[3]
a31 = a3[0]
a32 = a3[1]
a33 = a3[2]
a34 = a3[3]
r11 = R[0][0]
r12 = R[0][1]
r13 = R[0][2]
r21 = R[1][0]
r22 = R[1][1]
r23 = R[1][2]
r31 = R[2][0]
r32 = R[2][1]
r33 = R[2][2]
t1 = T[0]
t2 = T[1]
t3 = T[2]
b1 = [ 
    a11 * r11 + a12 * r21 + a13 * r31, 
    a11 * r12 + a12 * r22 + a13 * r32, 
    a11 * r13 + a12 * r23 + a13 * r33, 
    a11 * t1 + a12 * t2 + a13 * t3 + a14
    ]
b2 = [ 
    a21 * r11 + a22 * r21 + a23 * r31, 
    a21 * r12 + a22 * r22 + a23 * r32, 
    a21 * r13 + a22 * r23 + a23 * r33, 
    a21 * t1 + a22 * t2 + a23 * t3 + a24
    ]
b3 = [ 
    a31 * r11 + a32 * r21 + a33 * r31, 
    a31 * r12 + a32 * r22 + a33 * r32, 
    a31 * r13 + a32 * r23 + a33 * r33, 
    a31 * t1 + a32 * t2 + a33 * t3 + a34
    ]

#print(b1)
#print(b2)
#print(b3)

b11 = b1[0]
b12 = b1[1]
b13 = b1[2]
b14 = b1[3]
b21 = b2[0]
b22 = b2[1]
b23 = b2[2]
b24 = b2[3]
b31 = b3[0]
b32 = b3[1]
b33 = b3[2]
b34 = b3[3]

# 方程式
A = np.array([
    [ a11, a12, a13,   0,   0,   0,   0,   0,   0,   0,   0,   0],
    [   0,   0,   0, a11, a12, a13,   0,   0,   0,   0,   0,   0],
    [   0,   0,   0,   0,   0,   0, a11, a12, a13,   0,   0,   0],
    [   0,   0,   0,   0,   0,   0,   0,   0,   0, a11, a12, a13],
    [ a21, a22, a23,   0,   0,   0,   0,   0,   0,   0,   0,   0],
    [   0,   0,   0, a21, a22, a23,   0,   0,   0,   0,   0,   0],
    [   0,   0,   0,   0,   0,   0, a21, a22, a23,   0,   0,   0],
    [   0,   0,   0,   0,   0,   0,   0,   0,   0, a21, a22, a23],
    [ a31, a32, a33,   0,   0,   0,   0,   0,   0,   0,   0,   0],
    [   0,   0,   0, a31, a32, a33,   0,   0,   0,   0,   0,   0],
    [   0,   0,   0,   0,   0,   0, a31, a32, a33,   0,   0,   0],
    [   0,   0,   0,   0,   0,   0,   0,   0,   0, a31, a32, a33]
])
B = np.array([
    b11, b12, b13, b14 - a14, b21, b22, b23, b24 - a24, b31, b32, b33, b34 - a34
])

print(A)
print(B)

# A の逆行列
print(np.linalg.inv(A))

# A X = B を解く
X = np.dot(np.linalg.inv(A), B)

# 求まった R, T
R2 = np.array([
    [X[0], X[3], X[6]],
    [X[1], X[4], X[7]],
    [X[2], X[5], X[8]]
])
T2 = np.array([X[9], X[10], X[11]])

# 表示
print(R)
print(R2)
print(T)
print(T2)
